pico-8 cartridge // http://www.pico-8.com
version 29
__lua__

function _init()
	music(0)
	player = {}
	player.x = 5
	player.y = 5
	player.face = 'down'
	player.sprites = {
		['up'] = {['face'] = 6, ['tail']  = 22},
		['down'] = {['face'] = 54, ['tail']  = 38},
		['left'] = {['face'] = 40, ['tail']  = 41},
		['right'] = {['face'] = 43, ['tail']  = 42},
	}
	player.points = 0
	player.speed = 2
	player.energy = 100
	player.turning = false
	player.tail_x = player.x
	player.tail_y = player.y - 8
	player.wiggle_timer = 0
	player.wiggle = 0
	banana = {}
	banana.x = 50
	banana.y = 50
	shine = {}
	shine.time = 0
	shine.x = 0
	shine.y = 0
end

function _update()
-- wiggle
player.wiggle_timer = player.wiggle_timer + 0.5
player.wiggle = player.wiggle_timer % 2




-- left
	if(player.x > 0) then
		if(btn(0)) then 
		player.x=player.x-player.speed
		player.face = 'left'
		player.tail_x = player.x + 8
		player.tail_y = player.y
		end
	end
-- right
	if(player.x < 120) then
		if(btn(1)) then 
		player.x=player.x+player.speed 
		player.face = 'right'
		player.tail_x = player.x - 8
		player.tail_y = player.y
		end
	end
-- up
	if(player.y > 0) then
		if(btn(2)) then 
		player.y=player.y-player.speed
		player.face = 'up'
		player.tail_x = player.x
		player.tail_y = player.y + 8
		end
	end
-- down
	if(player.y < 120) then
		if(btn(3)) then 
		player.y=player.y+player.speed
		player.face = 'down'
		player.tail_x = player.x
		player.tail_y = player.y - 8
		end
	end
-- z
	if(btn(4) and player.energy > 1) then
	-- player.speed = player.speed + 1
	player.speed = adjSpeed(0.5)
	player.energy = player.energy - 2
	else
	player.speed = 1
	end

	if((mget(player.x /8, player.y/8)) == 3) then 
	-- player.speed = 0.5
	player.speed = adjSpeed(-0.5)
	end

	if(distance(player, banana) < 3) then 
	sfx(1)
	player.points = player.points + 1 
	banana.x = rnd(110)
	banana.y = rnd(110)
		if(player.energy < 70) then
			player.energy = player.energy + 30
			else
			player.energy = 100
		end
	end

	player.energy = player.energy - 0.25
end

function _draw()
	-- clear screen
	cls(1)
	-- draw map
	map()
	-- center camera
	camera()
	-- draw player (sprite, x, y)
    spr(player.sprites[player.face]['face'],player.x,player.y)
    spr(player.sprites[player.face]['tail'],player.tail_x,player.tail_y)
	-- draw banana
    spr(4,banana.x,banana.y)
	rect(0, 119, 101, 126, 8)
	rectfill(1, 120, player.energy, 125, 14)
	-- print("distance:"..distance(player,banana))
	print("player.face"..player.face)
	print("ball is on "..mget(player.x /8, player.y/8))
	str = "Points: "..player.points
	str_len = #str
	print(str, 64-str_len*2, 10, 2)
end

function distance(p0, p1)
 dx=p0.x-p1.x dy=p0.y-p1.y
 return sqrt(dx*dx+dy*dy)
end

-- function isInbounds()

-- end

function adjSpeed(inc)
target_speed = player.speed + inc
	if(inc < 0 and target_speed > 0.5) then
		return target_speed 	
	else if (target_speed < 3) then
		return target_speed
	else return player.speed
	end
	end
end

__gfx__
009999000099990033333333333a3333000000900000000000010000000010000000000009999990000000000000000000000000000000000000000000000000
09aaa99009aaa990333333333a3b3ab300000aa00000000000999000000999000995990000000009000000000000000000000000000000000000000000000000
9aa999999aa99999333333333b33b333000007a00000000009191900009191909999919000995994000000000000000000000000000000000000000000000000
9999999999999999333333333bb3b3a30000aaa00000000009999900009999909999999109199999000000000000000000000000000000000000000000000000
9919991991999199333333333b3bbbb3000aaa000000000005999500005999509999919019999999000000000000000000000000000000000000000000000000
9999999499999994333333333b3b3b339aaaaa000000000009999900009999904995440009199994000000000000000000000000000000000000000000000000
09999940099999403333333333333b330aaaa0000000000009999900009999409000000000995440000000000000000000000000000000000000000000000000
00444400004444003333333333333333000000000000000009999400000994000999999000000000000000000000000000000000000000000000000000000000
00999900009999000000000000000000000000000000000000994000000090000001000009499900000000000000000000000000000000000000000000000000
09aaa99009aaa9900000000000000000000000000000000000090000000940000099900990999990000000000000000000000000000000000000000000000000
9aa999999aa999990000000000000000000000000000000000090000009400000919190990999990000000000000000000000000000000000000000000000000
99999999999999990000000000000000000000000000000000099000000990000999990990599950000000000000000000000000000000000000000000000000
99199199999999990000000000000000000000000000000000009000000009000599950990999940000000000000000000000000000000000000000000000000
99999994999999940000000000000000000000000000000000094000000009000999990990919140000000000000000000000000000000000000000000000000
09999940099999400000000000000000000000000000000000940000000094000999990990099400000000000000000000000000000000000000000000000000
00444400004444000000000000000000000000000000000000400000000000000099949000001000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000099000000000000009900000000000000900000000990000099599900090000000990009995990000000000000000000000000000000000
00000000000000009990000000000000999000000000000000900000000009000919999990909000000909099999919000000000000000000000000000000000
00000000000000009000000000000000900000000000000000090000000009001999999999004990990900999999999100000000000000000000000000000000
00000000000000009000000000000000900000000000000000009000000990000919999940000000049400099999914000000000000000000000000000000000
00000000000000009000000000000000900000000000000000099000000900000099544400000000000000009995440000000000000000000000000000000000
00000000000000009000000000990000900000000000000000090000000090000000000000000000000000000000000000000000000000000000000000000000
00000000000000009000009999959900900000000990000000999000000090000000000000000000000000000000000000000000000000000000000000000000
00000000000000009000099999999590900000000959990009999900000999000000000000000000000000000000000000000000000000000000000000000000
00000000000000000990999999999590900000000999599009999900009999900000000000000000000000000000000000000000000000000000000000000000
00000000000000000099999999999991999999999999599009999900009999900099599000000000000000000995990000000000000000000000000000000000
00000000000000000009999999999000999999999999999105999500005999500919999900000900000000009999919000000000000000000000000000000000
00000000000000000000999999999000999999999999900009999900009999901999999999009090099000999999999100000000000000000000000000000000
00000000000000000000099999999900999999999999900009191400009191400919999409090000004909009999914000000000000000000000000000000000
00000000000000000000099440000400099499999999900000994000000994000099544004900000000094000995440000000000000000000000000000000000
00000000000000000000099994400000099940000000490000010000000010000000000000000000000000000000000000000000000000000000000000000000
99999999066666609070070900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666609070070966666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777066666609070070966666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666609070070966666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666609070070966666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77777777066666609070070966666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000066666609070070966666666000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
99999999066666609070070900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020203020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202030202020203020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020302020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202030202020202020202020200000040424200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202030202020202020200000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202030202020202020202020203020200000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020302020202020200000041000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
011400200c0433321500003332150c0430c00033215000030c0430000300003000030c0430c00000003332150c0430000333215332150c0430c00000003000030c0430000333215332150c0430c0003321533215
000300002f0773106733067340673207733067370673a0672d0002f0002f000210002b0002d0002f0002f000210002b0002d0002f000000070000700007000070000700007000070000700007000070000700007
011400200f0110f0110f0111b0110f1110f0110f0111b0110f0110f0110f0111b0110f1110f0110f0111b0110f0110f0110f0111b0110f1110f0110f0111b0110f0110f0110f0111b0110f1110f0110f0111b011
011400002c0052a0052c005270052a0052c025270252a0252c025270052a0052c005270052a0252c025270252a0252c025270252a0052c005270052a005270252a0252c025270252a0252a0252c005270052a005
__music__
02 00034344

